<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <title>Biblioteka – Wypożyczenia</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }

        section {
            margin-bottom: 40px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 6px 10px;
            text-align: left;
        }

        button {
            padding: 4px 8px;
            cursor: pointer;
        }

        input {
            margin-right: 6px;
        }
    </style>
</head>
<body>

    <h1>Biblioteka – system wypożyczeń</h1>
    <section>
        <h2>Książki</h2>
        <table id="booksTable">
            <thead>
                <tr>
                    <th>Tytuł</th>
                    <th>Autor</th>
                    <th>Dostępne</th>
                    <th>Akcja</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>
    <section>
        <h2>Dodaj czytelnika</h2>
        <input id="memberName" placeholder="Imię i nazwisko">
        <input id="memberEmail" placeholder="Email">
        <button onclick="addMember()">Dodaj</button>
    </section>
    <section>
        <h2>Dodaj książkę</h2>
        <input id="bookTitle" placeholder="Tytuł">
        <input id="bookAuthor" placeholder="Autor">
        <input id="bookCopies" type="number" placeholder="Egzemplarze" value="1">
        <button onclick="addBook()">Dodaj</button>
    </section>
    <section>
        <h2>Aktywne wypożyczenia</h2>
        <table id="loansTable">
            <thead>
                <tr>
                    <th>Czytelnik</th>
                    <th>Książka</th>
                    <th>Termin zwrotu</th>
                    <th>Akcja</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </section>

    <script>const api = "";

async function loadBooks() {
    const res = await fetch(api + "/api/books");
    const books = await res.json();

    const tbody = document.querySelector("#booksTable tbody");
    tbody.innerHTML = "";

    books.forEach(b => {
        const tr = document.createElement("tr");

        tr.innerHTML = `
            <td>${b.title}</td>
            <td>${b.author}</td>
            <td>${b.available}</td>
            <td>
                <button onclick="borrowBook(${b.id})">Wypożycz</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

async function borrowBook(bookId) {
    const memberId = prompt("Podaj ID czytelnika:");
    if (!memberId) return;

    const res = await fetch(api + "/api/loans/borrow", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
            memberId: Number(memberId),
            bookId: bookId
        })
    });

    if (!res.ok) {
        alert("Nie można wypożyczyć książki");
    }

    loadBooks();
    loadLoans();
}

async function addMember() {
    const name = document.getElementById("memberName").value;
    const email = document.getElementById("memberEmail").value;

    await fetch(api + "/api/members", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email })
    });

    alert("Dodano czytelnika");
}

async function addBook() {
    const title = document.getElementById("bookTitle").value;
    const author = document.getElementById("bookAuthor").value;
    const copies = Number(document.getElementById("bookCopies").value);

    await fetch(api + "/api/books", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ title, author, copies })
    });

    loadBooks();
}

async function loadLoans() {
    const res = await fetch(api + "/api/loans");
    const loans = await res.json();

    const tbody = document.querySelector("#loansTable tbody");
    tbody.innerHTML = "";

    loans
        .filter(l => l.returnDate === null)
        .forEach(l => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
                <td>${l.member}</td>
                <td>${l.book}</td>
                <td>${l.dueDate}</td>
                <td>
                    <button onclick="returnLoan(${l.id})">Zwróć</button>
                </td>
            `;
            tbody.appendChild(tr);
        });
}

async function returnLoan(id) {
    await fetch(api + "/api/loans/return?loanId=" + id, {
        method: "POST"
    });

    loadBooks();
    loadLoans();
}

loadBooks();
loadLoans();</script>

</body>
</html>
